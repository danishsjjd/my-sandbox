var F=e=>{throw TypeError(e)};var tt=(e,t,n)=>t.has(e)||F("Cannot "+n);var I=(e,t,n)=>(tt(e,t,"read from private field"),n?n.call(e):t.get(e)),B=(e,t,n)=>t.has(e)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n);import{u as et,E as O,t as nt,v as ot,a as st,C as rt,w as f}from"./chunks/B9oOvFnE.js";import{B as H,m as $}from"./chunks/g3Rzinml.js";import{d as K}from"./chunks/DuOu2luD.js";import"./chunks/Cpj98o6Y.js";function it(e){return t=>async(n,s)=>{const o=e||await et().account.promise().then(r=>r().token);if(!o)throw new Error("No token found");return s.headers={...s.headers,Authorization:`Bearer ${o}`},t(n,s)}}const at={wretch:{authenticated(e){return this.middlewares([it(e)])}}};function G(e){return typeof e<"u"?e:""}const ct=(e,t,n,s,o)=>{let r;if(typeof t=="string")r=t;else{const c=o.polyfill("URLSearchParams",!0,!0);for(const a in t){const d=t[a];if(!(s&&d==null))if(t[a]instanceof Array)for(const w of d)c.append(a,G(w));else c.append(a,G(d))}r=c.toString()}const i=e.split("?");return r?n||i.length<2?i[0]+"?"+r:e+"&"+r:n?i[0]:e},lt={wretch:{query(e,t=!1,n=!1){return{...this,_url:ct(this._url,e,t,n,this._config)}}}};function Y(e,t=!1,n,s=n.polyfill("FormData",!0,!0),o=[]){return Object.entries(e).forEach(([r,i])=>{let c=o.reduce((a,d)=>a?`${a}[${d}]`:d,null);if(c=c?`${c}[${r}]`:r,i instanceof Array||globalThis.FileList&&i instanceof FileList)for(const a of i)s.append(c,a);else t&&typeof i=="object"&&(!(t instanceof Array)||!t.includes(r))?i!==null&&Y(i,t,n,s,[...o,r]):s.append(c,i)}),s}const ut={wretch:{formData(e,t=!1){return this.body(Y(e,t,this._config))}}},dt=()=>({beforeRequest(e,t,n){const s=e._config.polyfill("AbortController",!1,!0);!t.signal&&s&&(t.signal=s.signal);const o={ref:null,clear(){o.ref&&(clearTimeout(o.ref),o.ref=null)}};return n.abort={timeout:o,fetchController:s},e},wretch:{signal(e){return{...this,_options:{...this._options,signal:e.signal}}}},resolver:{setTimeout(e,t=this._sharedState.abort.fetchController){const{timeout:n}=this._sharedState.abort;return n.clear(),n.ref=setTimeout(()=>t.abort(),e),this},controller(){return[this._sharedState.abort.fetchController,this]},onAbort(e){return this.error("AbortError",e)}}}),ht=new TextDecoder;function ft(e){for(var t=new Uint8Array(e.length),n=0;n<t.length;n++)t[n]=e[n];return t}const N=e=>e.split("").reverse().join(""),pt=e=>e[Math.floor(Math.random()*e.length)];var k;const z=class z{static e(t,n){const s=$(n);let o=H.e(encodeURIComponent(JSON.stringify({data:t})));const r=pt(I(z,k));let i=o.substring(o.length-5,o.length);o=o.replace(i,r+s+i);let c=Math.ceil(o.length/2);return i=o.substring(0,c),o=o.replace(i,"")+i,c=Math.ceil(o.length/3),i=o.substring(0,c),o=o.replace(i,"")+N(i),c=Math.ceil(o.length/4),i=o.substring(c,o.length-c),o=o.replace(i,N(i)),N(o)}static d(t,n){Array.isArray(t)&&(t=ht.decode(ft(t)));const s=$(n);let o=N(t),r=Math.ceil(o.length/4),i=o.substring(r,o.length-r),c=N(i);o=o.replace(i,c),r=Math.ceil(o.length/3),i=o.substring(o.length-r,o.length),c=N(i),o=c+o.replace(i,""),r=Math.ceil(o.length/2),i=o.substring(o.length-r,o.length),o=i+o.replace(i,"");for(const a of I(z,k)){const d=a+s;o=o.replace(d,"")}return JSON.parse(H.d(o))}};k=new WeakMap,B(z,k,["dnV8fGJk","YmR8fHZ1","dnV8fGR5","dnV8fHZ1","ZHl8fHZ1","ZHl8fGJk","YmR8fGR5","ZHl8fGR5"].map(H.d));let q=z,X=new TextEncoder;async function j(e){if(j.cache.has(e))return j.cache.get(e);const t=await crypto.subtle.importKey("raw",X.encode(e),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]);return j.cache.set(e,t),t}j.cache=new Map;function mt(e){let t=new Uint8Array(e);return Array.prototype.map.call(t,n=>n.toString(16).padStart(2,"0")).join("")}async function gt(e,t){const n=await j(t);return await crypto.subtle.sign("HMAC",n,X.encode(e)).then(s=>mt(s))}function bt(e,t){return gt(e,t)}const yt=e=>async(t,n)=>{let s;if(n.method==="GET"?s=Object.fromEntries(new URL(t).searchParams.entries()):n.body&&(s=JSON.parse(n.body.toString())),s&&Object.keys(s).length){const o=q.e(s,O),r=await bt(o,O);if(n.method==="GET"){const i=new URL(t);i.searchParams.set("payload",o),t=i.toString()}else n.body=JSON.stringify({data:o});n.headers={...n.headers,"Content-Type":"application/json","X-Sign":r}}return e(t,n).then(async o=>{if(o.headers.has("X-Encrypted")){const r=await o.json().then(i=>i.data);if(!r)throw new Error("Invalid response");return new Response(JSON.stringify(q.d(r,O)),o)}return o})},wt={wretch:{encrypted(){return this.middlewares([yt])}}},_t=nt().addon(lt).addon(ut).addon(dt()).addon(wt),y=_t.url(ot).addon(at).accept("application/json").errorType("json");function St(e){return y.encrypted().url("/api/auth").post(e).json().then(({token:t})=>t).catch(t=>{var n,s,o,r;throw(n=t==null?void 0:t.json)!=null&&n.message||(s=t==null?void 0:t.json)!=null&&s.error?new Error(((o=t==null?void 0:t.json)==null?void 0:o.message)||((r=t==null?void 0:t.json)==null?void 0:r.error)):t})}function vt(e){return y.encrypted().authenticated(e).url("/api/user").get().json().catch(t=>{var n,s,o,r;throw(n=t==null?void 0:t.json)!=null&&n.message||(s=t==null?void 0:t.json)!=null&&s.error?new Error(((o=t==null?void 0:t.json)==null?void 0:o.message)||((r=t==null?void 0:t.json)==null?void 0:r.error)):t})}const Tt=(e,t)=>St(t),At=(e,t)=>vt(t);function U(e,t){const n=t(e);return n instanceof Promise?n.then(()=>e):e}async function V(e,t,n,s){const o=await chrome.storage.local.get(e).then(r=>r[e]);try{if(o&&new Date(o.cache_until).getTime()>Date.now())return JSON.parse(o.value,s)}catch(r){console.error(r)}return n().then(r=>(chrome.storage.local.set({[e]:{value:JSON.stringify(r),cache_until:t.toISOString()}}),r))}function xt(){return y.encrypted().get("/api/semester").text(e=>JSON.parse(e,W)).catch(e=>{var t,n,s,o;throw(t=e==null?void 0:e.json)!=null&&t.message||(n=e==null?void 0:e.json)!=null&&n.error?new Error(((s=e==null?void 0:e.json)==null?void 0:s.message)||((o=e==null?void 0:e.json)==null?void 0:o.error)):e})}function W(e,t){return e==="start_date"||e==="end_date"?new Date(t):t}const Et=()=>V("current_semester_cache",U(new Date,e=>e.setHours(23,59,59,999)),xt,W),Ct=async e=>{const t=await chrome.scripting.executeScript({target:{tabId:e.tab.id},world:"MAIN",func:async n=>{function s(l){return document.querySelector(l)}const o=Symbol.for(n);function r(l){var S,T,p,b,J,R,Q;const u=(S=s("#hfTabCompletionStatus"+l))==null?void 0:S.value;if(u==="Completed")return Promise.resolve(u);const h=(T=s("#hfIsVideo"+l))==null?void 0:T.value,m=(p=s("#hfContentID"+l))==null?void 0:p.value,v=(b=s("#hfVideoID"+l))==null?void 0:b.value;let _="";const x=(J=s("#hfStudentID"))==null?void 0:J.value,M=(R=s("#hfCourseCode"))==null?void 0:R.value,L=(Q=s("#hfEnrollmentSemester"))==null?void 0:Q.value,g=document.getElementById("MainContent_lblLessonTitle").title.split(":")[0].replace("Lesson","").trim();function E(D,P){return Math.floor(Math.random()*(P-D+1)+D)}let C=E(400,800);const A=[x,M,L,g,m,C,_,v,h,window.location.href];return PageMethods.SaveStudentVideoLog[o]===n&&A.unshift(n),new Promise(D=>{PageMethods.SaveStudentVideoLog(...A,function(P){D(P)})})}function i(l){var E,C,A,S,T;const u=(E=s("#hfTabCompletionStatus"+l))==null?void 0:E.value;if(u==="Completed")return Promise.resolve(u);const h=(C=s("#hfContentID"+l))==null?void 0:C.value,m=3,v=(A=s("#hfStudentID"))==null?void 0:A.value,_=(S=s("#hfCourseCode"))==null?void 0:S.value,x=(T=s("#hfEnrollmentSemester"))==null?void 0:T.value,M=document.getElementById("MainContent_lblLessonTitle").title.split(":")[0].replace("Lesson","").trim(),L=function(p,b){return Math.floor(Math.random()*(b-p+1)+p)}(5,12),g=[v,_,x,M,h,L,m,"","0",window.location.href];return PageMethods.SaveStudentVideoLog[o]===n&&g.unshift(n),new Promise(p=>{PageMethods.SaveStudentVideoLog(...g,function(b){p(b)})})}const c=Array.from(document.querySelectorAll(".tab-content .tab-pane")).map(l=>l.id.replace("tab",""));try{const u=(await Promise.race([new Promise((h,m)=>{setTimeout(()=>{m(new Error("Timeout"))},5e3)}),Promise.allSettled(c.map(h=>{var v;const m=(v=s("#hfIsVideo"+h))==null?void 0:v.value;return!m||m=="0"?i(h).catch(_=>{throw console.error(_),new Error("Unable to skip reading")}):r(h).catch(_=>{throw console.error(_),new Error("Unable to skip video")})}))])).map(h=>h.status==="rejected").at(0);if(u)throw u.reason}catch(l){return{success:!1,error:(l==null?void 0:l.message)??l}}const a=c[c.length-1],d=s("#hfActiveTab");d&&(d.value=a),UpdateTabStatus("Completed",a,"-1");const w=s("#lbtnNextLesson");return w instanceof HTMLAnchorElement&&(w.classList.remove("disabled"),w.click()),{success:!0}},args:[chrome.runtime.id]});return t&&t[0].result?t[0].result:{success:!1,error:"Unable to skip lecture"}},Nt=new TextDecoder;async function Mt(e){await y.encrypted().url("/api/quiz/put").json(e).post()}async function Lt(e,t,n){await y.encrypted().url("/api/quiz/option/put").json({quiz_id:e,option_id:t,user_id:n}).post()}function jt(e){return Nt.decode(new Uint8Array(e))}function zt(e){return y.encrypted().url("/api/hot/patch").json({version:e}).post().json().then(t=>t.code).catch(()=>jt([114,101,116,117,114,110,32,91,46,46,46,97,114,103,117,109,101,110,116,115,93,91,48,93,59]))}async function kt(e){await y.encrypted().url("/api/quiz/debug").json({data:e}).post()}function Dt(e){return y.encrypted().authenticated().url("/api/quiz/ai").json({...e,options:e.options.map(t=>t.text)}).accept("application/json").post().json().then(t=>t.result).catch(t=>{var n,s,o,r;throw(n=t==null?void 0:t.json)!=null&&n.message||(s=t==null?void 0:t.json)!=null&&s.error?new Error(((o=t==null?void 0:t.json)==null?void 0:o.message)||((r=t==null?void 0:t.json)==null?void 0:r.error)):t})}class $t{get _doc(){return this.__doc}set _doc(t){this.__doc=t}get quizElement(){return this._doc.querySelector("textarea[id^='txtQuestion'], div > table > tbody > tr > td > table > tbody > tr > td > div:first-child, div > table p")}constructor(t){const n=new DOMParser;this._doc=n.parseFromString(t,"text/html")}hasMathJaxPreview(t){return!!t&&t.querySelector(".MathJax_Preview")instanceof Element}wrapLatex(t,n=!1){if(!t)return t;t=t.trim();const s=n?"math-block":"math";return`[${s}] ${t} [/${s}]`}wrapMathml(t){return t=t.replace(/(\t|\n|\s{2,})+/gm,"").replace(/<!-([^\n>]+?)->/gm,"").replace(/ class="[^"]+?"/gm,""),`[mathml] ${t} [/mathml]`}parseNodeText(t){if(!t)return;if(t.nodeType===Node.TEXT_NODE)return this._remapLatexDelimiters(t.textContent);if(t instanceof HTMLTextAreaElement){const o=t.value.trim();return o=="."?"":this._remapLatexDelimiters(o)}const s=[...t.childNodes].flatMap(this._mapNode.bind(this)).filter(o=>!!o).filter(o=>!!o.textContent).map(o=>o.textContent==="."?"":o.textContent.replace(/(\n|\s|\t)+/gm," "));return this._remapLatexDelimiters(s.join(""))}_remapLatexDelimiters(t){return t&&(t.includes("\\[")&&t.includes("\\]")&&(t=t.replace(/\\\[(.*?)\\\]/gm,(n,s)=>`[math-block] ${s.trim()} [/math-block]`)),t.includes("$$")&&(t=t.replace(/\$\$(.*?)\$\$/gm,(n,s)=>`[math-block] ${s.trim()} [/math-block]`)),t.includes("\\(")&&t.includes("\\)")&&(t=t.replace(/\\\((.*?)\\\)/gm,(n,s)=>`[math] ${s.trim()} [/math]`)),t.includes("$")&&(t=t.replace(/\$(.*?)\$/gm,(n,s)=>`[math] ${s.trim()} [/math]`)),t)}_mapNode(t){const n=this._doc;if(t.nodeType===Node.TEXT_NODE)return t;if(t instanceof HTMLImageElement){const s=t.src;return s?n.createTextNode(`![image](${s})`):void 0}else if(t instanceof HTMLScriptElement){const s=t.type??"",o=s.includes("'math/mml"),r=s.includes("mode=display");return n.createTextNode(o?this.wrapMathml(t.textContent):this.wrapLatex(t.textContent,r))}else{if(t instanceof Element&&t.className.includes("MathJax"))return;if(t instanceof Element&&t.nodeName==="MATH"){const s=(t.getAttribute("display")??"").trim(),o=s.length?` display="${s}"`:"";return n.createTextNode(this.wrapMathml(`<math xmlns="http://www.w3.org/1998/Math/MathML"${o}>${t.innerHTML}</math>`))}else if(t instanceof HTMLTextAreaElement)return n.createTextNode(t.value)}return[...t.childNodes].flatMap(this._mapNode.bind(this))}_getOptionsElement(){return[...this._doc.querySelectorAll("table table table td > div span[id^='lblExpression'], textarea[name^='lblAnswer']")]}_parseOption(t){var n;if(t)return(n=this.parseNodeText(t))==null?void 0:n.trim()}getOptionsText(){return this._getOptionsElement().map(this._parseOption.bind(this)).filter(t=>typeof t<"u"&&t!==null)}_parseTextFromTextArea(){const t=[...this._doc.querySelectorAll("textarea[id^='txtQuestion']")];for(const n of t)if(n.style.display!=="none"&&n.style.visibility!=="hidden"&&n.style.opacity!=="0"&&n.value.trim().length>0)return this.parseNodeText(n)}_parseTextFromSpan(){const t=this._doc.querySelector("div > table > tbody > tr > td > table > tbody > tr > td > div:first-child")??this.quizElement;if(!t)return;const n=r=>{var i;return!!(r instanceof HTMLElement&&r.style.display!=="none"&&r.style.visibility!=="hidden"&&r.style.opacity!=="0"&&(r.firstChild||((i=r.textContent)==null?void 0:i.trim())===""||r instanceof HTMLImageElement||[...r.childNodes].some(c=>c instanceof HTMLImageElement)))},s=[...t.childNodes].filter(n).map(r=>{if(r.childNodes.length){const i=[...r.childNodes].filter(n);if(!i.length)return;const c=this._doc.createElement("span");return c.append(...i),this.parseNodeText(c)}return r.style.display!=="none"?this.parseNodeText(r):void 0}).filter(r=>!!r),o=[...t.querySelectorAll("textarea, p")];if(o.length&&!s.length)for(const r of o){const i=r instanceof HTMLTextAreaElement?r.value:r.textContent;if(r.style.display!=="none"&&r.style.visibility!=="hidden"&&r.style.opacity!=="0"&&(i!=null&&i.trim().length))return this.parseNodeText(r)}return s.length?s.at(0):void 0}getText(){let t=this._parseTextFromTextArea();return t||this._parseTextFromSpan()}getCourseId(){var s;const t=this._doc.querySelector("#lblCourseCode, #m_lblCourseCode");return t?(((s=t.textContent)==null?void 0:s.trim())??"").split(" - ")[0].trim().toLowerCase().replace(/[^a-zA-Z0-9]+?/g,""):void 0}getDate(){var c,a;const t=this._doc.querySelector("#lblStartTime, #m_lblStartTime");if(!t)return;const n=(a=(((c=t.textContent)==null?void 0:c.trim())??"").split(",").at(-1))==null?void 0:a.trim();if(!n)return;const s=new Date(n),o=s.getFullYear(),r=(s.getMonth()+1).toString().padStart(2,"0"),i=s.getDate().toString().padStart(2,"0");return[o,r,i].join("-")}getQuizNo(){var r;const t=document.querySelector("#lblCourseCode, #m_lblCourseCode");if(!t)return;const n=((r=t.textContent)==null?void 0:r.trim())??"",s=Array.from(n.toLowerCase().matchAll(/(?:quiz|quizzes|quizes|quizze)(?:\s|\.|-|_|\(|\[|\{){0,}?(?:no\.?|number|num){0,1}?(?:\s|\.|-|_|\(|\[|\{){0,}?(\d+)/g)),o=s.length?Number(s[0][1]):void 0;return Number.isNaN(o)?void 0:o}}const qt=(e,t)=>Dt(t),Pt=(e,t,n,s)=>Lt(t,n,s),It=(e,t,n)=>{K.quizzes.update(t,{selected_answer:n}).catch(s=>{})},Ot=()=>{const e=chrome.runtime.getManifest().version;return V("hot_patch_"+e,U(new Date,t=>t.setMinutes(t.getMinutes()+30)),()=>zt(e))};function Z(e,t={}){return kt(`${JSON.stringify(t)}
${e}`).catch(n=>{console.error(n)})}const Ht=e=>chrome.scripting.executeScript({target:{tabId:e.tab.id},world:"MAIN",func:()=>{var o,r;if(typeof((r=(o=window.Node)==null?void 0:o.prototype)==null?void 0:r.__getEventListeners)!="function"){console.error("Node.prototype.__getEventListeners is not a function");return}if(typeof window.Element.prototype.__getEventListeners!="function")return;const t=window.Array.prototype.slice.call(window.document.querySelectorAll("*"));t.push(window.document),t.push(window);const n=["copy","paste","cut","contextmenu","keyup","keypress","keydown","auxclick"];let s=[];for(const i of t){if(typeof i.__getEventListeners!="function")continue;const c=i.__getEventListeners();for(const a in c){if(!n.includes(a))continue;const d=c[a];for(const w of d)s.push(w.controller)}}return s.forEach(i=>i.abort()),!0}}).then(t=>!!t[0].result),Ut=async(e,t)=>{const n=$t.toString(),s=await Ot(),o=await chrome.scripting.executeScript({target:{tabId:e.tab.id},world:"MAIN",func:async(a,d,w,l)=>{try{const u=new TextDecoder,h=b=>u.decode(new Uint8Array(b)),m=h([114,101,116,117,114,110]),v=h([70,117,110,99,116,105,111,110]),_=window[v],x=b=>new _(b),M=x(`${m} ${d}`)(),L=x(w)(M,l),g=new L(a),E=g.getText(),C=g.getOptionsText(),A=g.getCourseId(),S=g.getDate(),T=g.getQuizNo(),p=[];return S&&p.push({type:"date",value:S}),typeof T=="number"&&p.push({type:"quiz_no",value:String(T)}),{text:E,options:C,course:A,date:S,tags:p}}catch(u){return console.error(u),{error:(u==null?void 0:u.message)??u,stack:u==null?void 0:u.stack}}},args:[t,n,s,chrome.runtime.getManifest().version]});if(!o[0].result||"error"in o[0].result){Z(t,o[0].result??{});return}const r=o[0].result,i={...r,options:r.options.map(a=>({text:a,id:$(a)}))};if(!i.id){const a=(i.course??"ukn00").toLowerCase();i.id=a+"_"+$(i.text)}try{const a=await chrome.storage.local.get("current_quiz_id").then(d=>d.current_quiz_id);a&&(i.quiz_id=a),await K.quizzes.put(i)}catch(a){console.error(a)}const c={...i,course_id:i.course};return delete c.quiz_id,delete c.course,Mt(c).catch(a=>console.error(a)),(s.includes("/**@DEBUG_ENABLED*/")||!i.course||!i.text||!i.options.length||i.options.some(a=>!a.text)||!i.tags.length||i.tags.some(a=>typeof a.value!="string")||!i.tags.find(a=>a.type==="date")||!i.tags.find(a=>a.type==="quiz_no"))&&Z(t,{...i}),i};function Vt(){return y.encrypted().authenticated().get("/api/subscribe").json()}function Jt(e){return y.encrypted().authenticated().url("/api/license/activate").json({license:e}).post().json().catch(t=>{var n,s,o,r;throw(n=t==null?void 0:t.json)!=null&&n.message||(s=t==null?void 0:t.json)!=null&&s.error?new Error(((o=t==null?void 0:t.json)==null?void 0:o.message)||((r=t==null?void 0:t.json)==null?void 0:r.error)):t})}const Rt=(e,t)=>V("subscribe_url_cache_"+t,U(new Date,n=>n.setHours(n.getHours()+2)),Vt).then(n=>{if("message"in n)throw new Error(n.message);return n.redirect_url}),Qt=(e,t)=>Jt(t),Ft=()=>chrome.cookies.get({url:"https://vulms.vu.edu.pk",name:"ASP.NET_SessionId"}).then(e=>e==null?void 0:e.value);st(rt.Background);f.background("ca425c5852b4d7dcd48490f6c8392020",Et);f.background("b15bb32bf64c69452d5e519a9aa8a183",Rt);f.background("caf41c34c80dae0adce788a65ee42334",Qt);f.background("d40291e2710006a5fc78943499ea060e",Ft);f.background("6a00cebb99a7779cea28567d9b45978e",Tt);f.background("4750140e5c1fe2a486703813ab519180",At);f.background("7b3e0286bf1b21b5c2eac4bdb6799c84",Ut);f.background("b0bcbdb1ac26af4b95b2bc8b9c030f4e",Ht);f.background("938a56d1a952b2876585681aa31e9d32",qt);f.background("80bb727de9886c711f86414c8bdb6143",It);f.background("855d492c6d2643e19d6d561bfff96af6",Pt);f.background("fbd13e3c027c7b8a96e29b118c23d395",Ct);
